<html>
<body>
	 <script type="text/javascript" src="jquery-1.11.2.min.js"></script>
	 <script type="text/javascript" src="smtp.js"></script>
    <script type="text/javascript">
		

    </script>
    <h3 id="indicator"></h3>   
 	<h2 id="question"></h2>   
    <input type="radio" name="rbnNumber" id="radio1" value="1"><label id="label1" for="radio1">Answer 1</label></input><br>
    <input type="radio" name="rbnNumber" id="radio2" value="2"><label id="label2" for="radio2">Answer 2</label></input><br>
    <input type="radio" name="rbnNumber" id="radio3" value="3"><label id="label3" for="radio3">Answer 3</label></input><br>
    <input type="radio" name="rbnNumber" id="radio4" value="4"><label id="label4" for="radio4">Answer 4</label></input><br>
    <input type="radio" name="rbnNumber" id="radio5" value="5"><label id="label5" for="radio5">Answer 5</label></input><br>
    <br>
    <p></p>
    <input type="button" id="btnNext" Value="Next" />
    <script type="text/javascript">
    	$.urlParam = function(name){
			var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
			return results[1] || 0;
		}

		name = unescape( $.urlParam('name') ) ;
		email = unescape( $.urlParam('email') ) ;
		phone = unescape( $.urlParam('phone') ) ;

    	var total = 0 ;
    	var counter = 0 ;
    	var answer = "" ;
    	score = 0 ;
    	

    	function loadN()
    	{
    		$("#indicator").text((total - counter) + " question(s) remain.") ;
    		$("#question").text("Q " + (counter+1) + ".: " + quiz.questions[counter].question) ;
    		//console.log(quiz.questions[counter].options[0]) ;
    		$("#label1").html(quiz.questions[counter].options[0]) ;
    		$("#label2").html(quiz.questions[counter].options[1]) ;
    		$("#label3").html(quiz.questions[counter].options[2]) ;
    		$("#label4").html(quiz.questions[counter].options[3]) ;
    		$("#label5").html(quiz.questions[counter].options[4]) ;

    	}

    	function finish() {
    		message = "Quiz Result, " + name + "," + email + ", " + phone + ", " + score ;
			Email.send({
			    SecureToken : "90c63571-0357-4b40-9024-bc4fd31b565b",
			    To : [ email, 'swarupananda@rediffmail.com' ],
			    From : 'swarupananda@rediffmail.com',
			    Subject : message,
			    Body : message
			}).then(
			  message => alert(message)
			);

    	}

    	$(document).ready(function(){
    		const URL = 'http://localhost/quiz/ex.json' ;
			var request = new XMLHttpRequest();
			request.open('GET', URL, true); 
			request.responseType = 'text'; // if you make it json, request.response becomes a json object
			//https://stackoverflow.com/questions/22356025/force-cache-control-no-cache-in-chrome-via-xmlhttprequest-on-f5-reload
			request.setRequestHeader("Cache-Control", "no-cache, no-store, must-revalidate");
			request.onload = function() {
			//console.log(request.response) ;
			quiz = JSON.parse(request.response) ;
			total = quiz.questions.length ;

			loadN() ;
		}
		request.send();

		    $('#btnNext').click(function() {
		        var selValue = $('input[name=rbnNumber]:checked').val(); 
		        $('input[name=rbnNumber]:checked').prop("checked", false);
		        if ( selValue == quiz.questions[counter].answer)
		        	score++ ;
		        
		        counter++ ;
		        if ( counter == quiz.questions.length-1) // if last question
		        {
		        	$("#btnNext").val("Finish") ;
		        }
		        
		        if ( counter == quiz.questions.length)
		        {

		        	finish() ;
		        }
		        else
		        {
			        loadN() ;
		        }
		    });
		});
    </script>

</body>
</html>